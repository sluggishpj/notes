---
title: ES2024
---

# ES2024

## Well-Formed Unicode Strings

### ä»€ä¹ˆæ˜¯åŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBMPï¼‰ï¼Ÿ

åŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBasic Multilingual Planeï¼ŒBMPï¼‰æ˜¯Unicodeå­—ç¬¦é›†ä¸­çš„ä¸€ä¸ªå¹³é¢ï¼Œå…¶ç ç‚¹èŒƒå›´æ˜¯U+0000åˆ°U+FFFFã€‚è¿™ä¸ªå¹³é¢åŒ…å«äº†ç»å¤§å¤šæ•°å¸¸ç”¨çš„Unicodeå­—ç¬¦ï¼ŒåŒ…æ‹¬æ‹‰ä¸å­—æ¯ã€å¸Œè…Šå­—æ¯ã€è¥¿é‡Œå°”å­—æ¯ã€é˜¿æ‹‰ä¼¯æ•°å­—ã€ä¸­æ—¥éŸ©æ–‡å­—ç­‰ã€‚

### ä»€ä¹ˆæ˜¯ä»£ç†å¯¹ï¼Ÿ

JS ä¸­çš„å­—ç¬¦ä¸²æ˜¯ UTF-16 ç¼–ç çš„ã€‚åœ¨UTF-16ç¼–ç ä¸­ï¼Œä»£ç†å¯¹ï¼ˆSurrogate Pairï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¼–ç æœºåˆ¶ï¼Œç”¨äºè¡¨ç¤ºé‚£äº›è¶…å‡ºåŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBMPï¼‰çš„Unicodeå­—ç¬¦ã€‚è¿™äº›å­—ç¬¦çš„Unicodeç ç‚¹é«˜äºU+FFFFï¼Œå› æ­¤æ— æ³•ç”¨ä¸€ä¸ª16ä½çš„UTF-16ç å…ƒæ¥è¡¨ç¤ºã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒUTF-16å¼•å…¥äº†ä»£ç†å¯¹æœºåˆ¶ã€‚

ä»£ç†å¯¹æ˜¯ç”±ä¸¤ä¸ª16ä½çš„ç å…ƒç»„æˆçš„ï¼š
- ä¸€ä¸ªç§°ä¸ºé«˜ä»£ç†ï¼ˆæˆ–é«˜ä»£ç†ç å…ƒï¼‰ï¼Œå…¶ç ç‚¹èŒƒå›´åœ¨U+D800åˆ°U+DBFFä¹‹é—´
- å¦ä¸€ä¸ªç§°ä¸ºä½ä»£ç†ï¼ˆæˆ–ä½ä»£ç†ç å…ƒï¼‰ï¼Œå…¶ç ç‚¹èŒƒå›´åœ¨U+DC00åˆ°U+DFFFä¹‹é—´ã€‚è¿™ä¸¤ä¸ªç å…ƒåˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥è¡¨ç¤ºä¸€ä¸ªè¶…å‡ºBMPçš„Unicodeå­—ç¬¦ã€‚

ä¾‹å¦‚ï¼ŒUnicodeç ç‚¹U+10000ï¼ˆè¿™æ˜¯BMPä¹‹å¤–çš„ç¬¬ä¸€ä¸ªç ç‚¹ï¼‰åœ¨UTF-16ä¸­çš„ç¼–ç å°±æ˜¯é«˜ä»£ç†ç å…ƒU+D800å’Œä½ä»£ç†ç å…ƒU+DC00çš„ç»„åˆï¼Œå³â€œD800 DC00â€ã€‚åŒæ ·ï¼Œç ç‚¹U+10001çš„UTF-16ç¼–ç å°±æ˜¯â€œD800 DC01â€ï¼Œä»¥æ­¤ç±»æ¨ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒUTF-16ç¼–ç èƒ½å¤Ÿå®Œå…¨è¡¨ç¤ºæ‰€æœ‰Unicodeå­—ç¬¦ï¼Œæ— è®ºæ˜¯BMPå†…çš„è¿˜æ˜¯BMPå¤–çš„ã€‚è¿™ç§ä»£ç†å¯¹æœºåˆ¶æ˜¯UTF-16ç¼–ç æ–¹æ¡ˆçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½¿å¾—UTF-16æˆä¸ºä¸€ç§èƒ½å¤Ÿçµæ´»å¤„ç†å„ç§è¯­è¨€å­—ç¬¦çš„ç¼–ç æ–¹å¼ã€‚

### String.prototype.isWellFormed()

`isWellFormed()` æ–¹æ³•ç”¨äºæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æ ¼å¼è‰¯å¥½çš„ Unicode ä»£ç ç‚¹åºåˆ—ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ä»£ç†å¯¹éƒ½æ˜¯å®Œæ•´ä¸”æœ‰æ•ˆçš„ï¼Œåˆ™è¿”å› `true`ï¼›å¦‚æœå­˜åœ¨å­¤ç«‹çš„ä»£ç†ç å…ƒï¼ˆå³ä¸æˆå¯¹çš„é«˜ä»£ç†æˆ–ä½ä»£ç†ç å…ƒï¼‰ï¼Œåˆ™è¿”å› `false`ã€‚

#### ç¤ºä¾‹

```js
// æ ¼å¼è‰¯å¥½çš„å­—ç¬¦ä¸²
const wellFormed = "JavaScript";
console.log(wellFormed.isWellFormed()); // true

// åŒ…å«è¡¨æƒ…ç¬¦å·çš„æ ¼å¼è‰¯å¥½å­—ç¬¦ä¸²ï¼ˆè¡¨æƒ…ç¬¦å·é€šå¸¸ç”±ä»£ç†å¯¹è¡¨ç¤ºï¼‰
const emoji = "ğŸ˜Š";
console.log(emoji.isWellFormed()); // true

// æ ¼å¼ä¸è‰¯çš„å­—ç¬¦ä¸²ï¼ˆåŒ…å«å­¤ç«‹çš„é«˜ä»£ç†ç å…ƒï¼‰
const highSurrogate = "\uD800";
console.log(highSurrogate.isWellFormed()); // false

// æ ¼å¼ä¸è‰¯çš„å­—ç¬¦ä¸²ï¼ˆåŒ…å«å­¤ç«‹çš„ä½ä»£ç†ç å…ƒï¼‰
const lowSurrogate = "\uDC00";
console.log(lowSurrogate.isWellFormed()); // false

// æ ¼å¼è‰¯å¥½çš„ä»£ç†å¯¹
const surrogatePair = "\uD83D\uDE0A"; // ç­‰åŒäº "ğŸ˜Š"
console.log(surrogatePair.isWellFormed()); // true

// æ ¼å¼ä¸è‰¯çš„ä»£ç†å¯¹ï¼ˆä»£ç†ç å…ƒä¸åˆæ³•ï¼‰
const invalidSurrogatePair = "\uD800\u0061"; // ä¸åˆæ³•çš„ä»£ç†å¯¹
console.log(invalidSurrogatePair.isWellFormed()); // false
```

### String.prototype.toWellFormed()

`toWellFormed()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­æ‰€æœ‰å­¤ç«‹çš„ä»£ç†ç å…ƒéƒ½è¢«æ›¿æ¢ä¸º Unicode æ›¿æ¢å­—ç¬¦ U+FFFD (ï¿½)ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥ä¿®å¤æ ¼å¼ä¸è‰¯çš„ Unicode å­—ç¬¦ä¸²ï¼Œä½¿å…¶æˆä¸ºæ ¼å¼è‰¯å¥½çš„å­—ç¬¦ä¸²ã€‚

- å¦‚æœåŸå­—ç¬¦ä¸²å·²ç»æ˜¯æ ¼å¼è‰¯å¥½çš„ï¼Œåˆ™è¿”å›ä¸åŸå­—ç¬¦ä¸²ç›¸åŒçš„æ–°å­—ç¬¦ä¸²
- å¦‚æœåŸå­—ç¬¦ä¸²åŒ…å«å­¤ç«‹çš„ä»£ç†ç å…ƒï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œå…¶ä¸­è¿™äº›å­¤ç«‹çš„ä»£ç†ç å…ƒè¢«æ›¿æ¢ä¸º U+FFFD(ï¿½)

#### ç¤ºä¾‹

```js
// æ ¼å¼è‰¯å¥½çš„å­—ç¬¦ä¸²ä¿æŒä¸å˜
const wellFormed = "JavaScript";
console.log(wellFormed.toWellFormed()); // "JavaScript"
console.log(wellFormed.toWellFormed() === wellFormed); // trueï¼ˆå†…å®¹ç›¸åŒä½†æ˜¯æ–°å­—ç¬¦ä¸²ï¼‰

// åŒ…å«è¡¨æƒ…ç¬¦å·çš„æ ¼å¼è‰¯å¥½å­—ç¬¦ä¸²ä¿æŒä¸å˜
const emoji = "ğŸ˜Š";
console.log(emoji.toWellFormed()); // "ğŸ˜Š"

// æ ¼å¼ä¸è‰¯çš„å­—ç¬¦ä¸²ï¼ˆåŒ…å«å­¤ç«‹çš„é«˜ä»£ç†ç å…ƒï¼‰è¢«ä¿®å¤
const highSurrogate = "\uD800";
console.log(highSurrogate.toWellFormed()); // "ï¿½"
console.log(highSurrogate.toWellFormed() === "\uFFFD"); // true

// æ ¼å¼ä¸è‰¯çš„å­—ç¬¦ä¸²ï¼ˆåŒ…å«å­¤ç«‹çš„ä½ä»£ç†ç å…ƒï¼‰è¢«ä¿®å¤
const lowSurrogate = "\uDC00";
console.log(lowSurrogate.toWellFormed()); // "ï¿½"

// æ··åˆæ ¼å¼çš„å­—ç¬¦ä¸²
const mixed = "JavaScript \uD800 is \uDC00 awesome";
console.log(mixed.toWellFormed()); // "JavaScript ï¿½ is ï¿½ awesome"

// ä¸ isWellFormed ç»“åˆä½¿ç”¨
function safeProcessString(str) {
  if (!str.isWellFormed()) {
    console.warn("å­—ç¬¦ä¸²æ ¼å¼ä¸è‰¯ï¼Œå·²è‡ªåŠ¨ä¿®å¤");
    return str.toWellFormed();
  }
  return str;
}

const input = "ç”¨æˆ·è¾“å…¥: \uD800";
console.log(safeProcessString(input)); // "ç”¨æˆ·è¾“å…¥: ï¿½"ï¼ˆå¹¶è¾“å‡ºè­¦å‘Šï¼‰
```

- å¯ç”¨äºæ•°æ®æ¸…ç†ï¼šåœ¨å¤„ç†æ¥è‡ªä¸å¯ä¿¡æ¥æºçš„æ–‡æœ¬æ•°æ®æ—¶ï¼Œç¡®ä¿å­—ç¬¦ä¸²æ ¼å¼æ­£ç¡®ã€‚æ¯”å¦‚ `encodeURI`åœ¨ç¼–ç ä¸€ä¸ªéé«˜ - ä½ä½å®Œæ•´çš„ä»£ç†å­—ç¬¦ä¼šæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨ `toWellFormed` å…ˆå¤„ç†æºå­—ç¬¦ä¸²ï¼Œå°±ä¸ä¼šæŠ¥é”™äº†ã€‚


## `Atomics.waitAsync()`

`Atomics.waitAsync()` æ–¹æ³•æ˜¯ `Atomics.wait()` æ–¹æ³•çš„å¼‚æ­¥ç‰ˆæœ¬ã€‚å®ƒè¿”å›ä¸€ä¸ª `Promise`ï¼Œå½“æŒ‡å®šçš„ç´¢å¼•å¤„çš„å…ƒç´ çš„å€¼æ»¡è¶³ç»™å®šçš„æ¡ä»¶æ—¶ï¼Œè¯¥ `Promise` ä¼šè¢«è§£æã€‚

> Atomics: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Atomics


## RegExp v flag with set notation + properties of strings

### `v` æ ‡å¿—

`v` æ ‡å¿—æ˜¯ ES2024 å¼•å…¥çš„ä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼æ ‡å¿—ï¼Œå®ƒå¯ç”¨äº†ä¸€äº›æ–°çš„ç‰¹æ€§ï¼š

1. é›†åˆè¡¨ç¤ºæ³•
2. å­—ç¬¦ä¸²å±æ€§è½¬ä¹‰

### é›†åˆè¡¨ç¤ºæ³•

`v` æ ‡å¿—å…è®¸ä½¿ç”¨æ›´çµæ´»çš„é›†åˆè¿ç®—ç¬¦æ¥å®šä¹‰å­—ç¬¦ç±»ï¼š

- å¹¶é›†è¿ç®—ï¼šä½¿ç”¨ `||` 
- äº¤é›†è¿ç®—ï¼šä½¿ç”¨ `&&`
- å·®é›†è¿ç®—ï¼šä½¿ç”¨ `--`
- åµŒå¥—é›†åˆï¼šä½¿ç”¨ `[]`

#### ç¤ºä¾‹

```js
// å¹¶é›†è¿ç®—
const vowelRegex = /[aeiou]||[AEIOU]/v;
console.log(vowelRegex.test("Hello")); // true

// äº¤é›†è¿ç®—ï¼šåŒ¹é…æ—¢æ˜¯æ•°å­—åˆæ˜¯å¶æ•°çš„å­—ç¬¦
const evenDigitRegex = /[[\d]&&[02468]]/v;
console.log(evenDigitRegex.test("2")); // true
console.log(evenDigitRegex.test("1")); // false

// å·®é›†è¿ç®—ï¼šåŒ¹é…éæ•°å­—å­—ç¬¦ï¼ˆæ’é™¤æ•°å­—ï¼‰
const nonDigitRegex = /[[\D]--[0-9]]/v;
console.log(nonDigitRegex.test("abc")); // true
console.log(nonDigitRegex.test("123")); // false

// åµŒå¥—é›†åˆ
const alphanumericRegex = /[a-zA-Z]&&[0-9]||[A-Z]&&[a-z]/v;
console.log(alphanumericRegex.test("a1")); // true
```


### å­—ç¬¦ä¸²å±æ€§è½¬ä¹‰

`v` æ ‡å¿—å…è®¸åœ¨å­—ç¬¦ç±»ä¸­ä½¿ç”¨æ›´å¤šå­—ç¬¦ä¸²å±æ€§è½¬ä¹‰ï¼ŒåŒ…æ‹¬ï¼š

- `Basic_Emoji`
- `Emoji_Keycap_Sequence`
- `RGI_Emoji_Modifier_Sequence`
- `RGI_Emoji_Flag_Sequence`
- `RGI_Emoji_Tag_Sequence`
- `RGI_Emoji_ZWJ_Sequence`
- `RGI_Emoji`

#### ç¤ºä¾‹

```js
const re = /^\p{RGI_Emoji}$/v;

// Match an emoji that consists of just 1 code point:
re.test('âš½'); // '\u26BD'
// â†’ true âœ…

// Match an emoji that consists of multiple code points:
re.test('ğŸ‘¨ğŸ¾â€âš•ï¸'); // '\u{1F468}\u{1F3FE}\u200D\u2695\uFE0F'
// â†’ true âœ…
```

### æ³¨æ„äº‹é¡¹

- `v` æ ‡è¯†å®Œå…¨ç‹¬ç«‹äº `u` æ ‡è¯†ï¼ŒäºŒè€…ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼ˆå¦åˆ™æŠ¥é”™ï¼‰
- å½“iæ ‡è¯†è¢«ä½¿ç”¨æ—¶ï¼Œ`u`å’Œ`v`æ ‡è¯†ç¬¦çš„åŒ¹é…é€»è¾‘ä¸åŒï¼š

> When the `i` flag is set, `\P` character classes are handled slightly differently in `u` and `v` modes. In `u` mode, case-folding happens after subtraction; in `v` mode, case-folding happens before subtraction. More concretely, in `u` mode, `\P{property}` matches `caseFold(allCharacters - charactersWithProperty)`. This means `/\P{Lowercase_Letter}/iu` still matches "a", because A is not a `Lowercase_Letter`. In `v` mode, `\P{property}` matches `caseFold(allCharacters) - caseFold(charactersWithProperty)`. This means `/\P{Lowercase_Letter}/iv` does not match "a", because A is not even in the set of all case-folded Unicode characters.  
> ref: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape

### æ›´å¤šå­—ç¬¦ä¸²å±æ€§è½¬ä¹‰

> https://www.unicode.org/reports/tr44/#Property_Index_Table


## Resizable and growable ArrayBuffers

ES2024 å¼•å…¥äº†å¯è°ƒæ•´å¤§å°çš„ ArrayBuffer å’Œ SharedArrayBufferï¼Œå…è®¸å¼€å‘è€…åŠ¨æ€è°ƒæ•´è¿™äº›ç¼“å†²åŒºçš„å¤§å°ï¼Œè€Œä¸å¿…åˆ›å»ºæ–°çš„ç¼“å†²åŒºå¹¶å¤åˆ¶æ•°æ®ã€‚

### æ–°çš„æ„é€ å‡½æ•°é€‰é¡¹

æ–°çš„æ„é€ å‡½æ•°é€‰é¡¹å…è®¸åˆ›å»ºå¯è°ƒæ•´å¤§å°çš„ç¼“å†²åŒºï¼š

```js
// åˆ›å»ºä¸€ä¸ªå¯è°ƒæ•´å¤§å°çš„ ArrayBuffer
const buffer = new ArrayBuffer(1024, { maxByteLength: 2048 });

// åˆ›å»ºä¸€ä¸ªå¯è°ƒæ•´å¤§å°çš„ SharedArrayBuffer
const sharedBuffer = new SharedArrayBuffer(1024, { maxByteLength: 2048 });
```

å‚æ•°è¯´æ˜ï¼š

- ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åˆå§‹å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰
- ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå…¶ä¸­ `maxByteLength` æŒ‡å®šäº†ç¼“å†²åŒºå¯ä»¥å¢é•¿åˆ°çš„æœ€å¤§å­—èŠ‚é•¿åº¦


### æ–°çš„å®ä¾‹æ–¹æ³•
`ArrayBuffer.prototype.resize()` å’Œ `SharedArrayBuffer.prototype.grow()`
è¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºè°ƒæ•´ç¼“å†²åŒºçš„å¤§å°ï¼š

```js
// åˆ›å»ºä¸€ä¸ªå¯è°ƒæ•´å¤§å°çš„ ArrayBuffer
const buffer = new ArrayBuffer(1024, { maxByteLength: 2048 });
console.log(buffer.byteLength); // 1024

// è°ƒæ•´ ArrayBuffer çš„å¤§å°
buffer.resize(1536);
console.log(buffer.byteLength); // 1536

// åˆ›å»ºä¸€ä¸ªå¯è°ƒæ•´å¤§å°çš„ SharedArrayBuffer
const sharedBuffer = new SharedArrayBuffer(1024, { maxByteLength: 2048 });
console.log(sharedBuffer.byteLength); // 1024

// å¢åŠ  SharedArrayBuffer çš„å¤§å°
sharedBuffer.grow(1536);
console.log(sharedBuffer.byteLength); // 1536
```
æ³¨æ„äº‹é¡¹ï¼š

- `resize()` æ–¹æ³•å¯ä»¥å¢å¤§æˆ–å‡å° ArrayBuffer çš„å¤§å°
- `grow()` æ–¹æ³•åªèƒ½å¢åŠ  SharedArrayBuffer çš„å¤§å°ï¼Œä¸èƒ½å‡å°
- è°ƒæ•´å¤§å°æ—¶ä¸èƒ½è¶…è¿‡åˆ›å»ºæ—¶æŒ‡å®šçš„ `maxByteLength`
- å½“å‡å° ArrayBuffer å¤§å°æ—¶ï¼Œè¶…å‡ºæ–°å¤§å°çš„æ•°æ®ä¼šè¢«æˆªæ–­

### æ–°çš„å®ä¾‹å±æ€§
`ArrayBuffer.prototype.resizable` å’Œ `SharedArrayBuffer.prototype.growable`
è¿™ä¸¤ä¸ªå±æ€§ç”¨äºæ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦å¯ä»¥è°ƒæ•´å¤§å°ï¼š

```js
const regularBuffer = new ArrayBuffer(1024);
console.log(regularBuffer.resizable); // false

const resizableBuffer = new ArrayBuffer(1024, { maxByteLength: 2048 });
console.log(resizableBuffer.resizable); // true

const regularSharedBuffer = new SharedArrayBuffer(1024);
console.log(regularSharedBuffer.growable); // false

const growableSharedBuffer = new SharedArrayBuffer(1024, { maxByteLength: 2048 });
console.log(growableSharedBuffer.growable); // true
```

`ArrayBuffer.prototype.maxByteLength` å’Œ `SharedArrayBuffer.prototype.maxByteLength`
è¿™ä¸¤ä¸ªå±æ€§è¿”å›ç¼“å†²åŒºå¯ä»¥å¢é•¿åˆ°çš„æœ€å¤§å­—èŠ‚é•¿åº¦ï¼š

```js
const buffer = new ArrayBuffer(1024, { maxByteLength: 2048 });
console.log(buffer.maxByteLength); // 2048

const sharedBuffer = new SharedArrayBuffer(1024, { maxByteLength: 2048 });
console.log(sharedBuffer.maxByteLength); // 2048
```

> https://github.com/tc39/proposal-resizablearraybuffer

## Array Grouping

### `Object.groupBy()`

`Object.groupBy()` æ–¹æ³•æ˜¯ ES2024 å¼•å…¥çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­æ¯ä¸ªé”®éƒ½æ˜¯å›è°ƒå‡½æ•°è¿”å›çš„å€¼ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å›è°ƒå‡½æ•°è¿”å›è¯¥é”®çš„å…ƒç´ ã€‚

æ³¨æ„ï¼š`Object.groupBy()` è¿”å›çš„å¯¹è±¡çš„åŸå‹æ˜¯`null`ï¼Œå› æ­¤æ— æ³•ç›´æ¥ä½¿ç”¨ `Object` åŸå‹ä¸Šçš„æ–¹æ³•ï¼Œæ¯”å¦‚ `hasOwnProperty` ç­‰ã€‚

#### ç¤ºä¾‹

```js
const array = [1, 2, 3, 4, 5];

// `Object.groupBy` groups items by arbitrary key.
// In this case, we're grouping by even/odd keys
var o = Object.groupBy(array, (num, index) => {
  return num % 2 === 0 ? 'even': 'odd';
});
// =>  { odd: [1, 3, 5], even: [2, 4] }

o.hasOwnProperty // undefined
Object.getPrototypeOf(o) // null
```

### `Map.groupBy()`

`Map.groupBy()` æ–¹æ³•æ˜¯ ES2024 å¼•å…¥çš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª `Map`ï¼Œå…¶ä¸­æ¯ä¸ªé”®éƒ½æ˜¯å›è°ƒå‡½æ•°è¿”å›çš„å€¼ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰å›è°ƒå‡½æ•°è¿”å›è¯¥é”®çš„å…ƒç´ ã€‚


#### ç¤ºä¾‹

```js
const array = [1, 2, 3, 4, 5];

// `Map.groupBy` returns items in a Map, and is useful for grouping
// using an object key.
const odd  = { odd: true };
const even = { even: true };
Map.groupBy(array, (num, index) => {
  return num % 2 === 0 ? even: odd;
});
// =>  Map { {odd: true}: [1, 3, 5], {even: true}: [2, 4] }
```

## `Promise.withResolvers()`

`Promise.withResolvers()`è¿”å›ä¸€ä¸ªåŒ…å«æ–°åˆ›å»ºçš„ Promise åŠå…¶æ§åˆ¶å‡½æ•°çš„å¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•ç®€åŒ–äº†åœ¨éœ€è¦å¤–éƒ¨æ§åˆ¶ Promise çŠ¶æ€çš„åœºæ™¯ä¸‹çš„ä»£ç ç¼–å†™ã€‚

è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ï¼š
- `promise`: ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹
- `resolve`: ç”¨äºå°† Promise çŠ¶æ€å˜ä¸ºå·²å®Œæˆï¼ˆfulfilledï¼‰çš„å‡½æ•°
- `reject`: ç”¨äºå°† Promise çŠ¶æ€å˜ä¸ºå·²æ‹’ç»ï¼ˆrejectedï¼‰çš„å‡½æ•°

### ç¤ºä¾‹

```js
const { promise, resolve, reject } = Promise.withResolvers();
```

è€Œä¹‹å‰ç­‰ä»·çš„åšæ³•æ˜¯

```js
let resolve, reject;  
const promise = new Promise((res, rej) => {  
  resolve = res;  
  reject = rej;  
});
```

## ArrayBuffer transfer

ArrayBuffer çš„è½¬ç§»åŠŸèƒ½ï¼Œå…è®¸åœ¨ä¸å¤åˆ¶åº•å±‚å†…å­˜çš„æƒ…å†µä¸‹å°† ArrayBuffer çš„æ‰€æœ‰æƒä»ä¸€ä¸ªä¸Šä¸‹æ–‡è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªåŠŸèƒ½é€šè¿‡æ–°çš„ `ArrayBuffer.prototype.transfer()` å’Œ `ArrayBuffer.prototype.transferToFixedLength()` æ–¹æ³•å®ç°ã€‚

### `ArrayBuffer.prototype.transfer()`

`transfer()` æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„ ArrayBufferï¼Œå…¶å†…å®¹ä¸åŸå§‹ ArrayBuffer ç›¸åŒï¼Œä½†åŸå§‹ ArrayBuffer ä¼šè¢«åˆ†ç¦»ï¼ˆdetachedï¼‰ï¼Œå³å˜ä¸ºä¸å¯ç”¨çŠ¶æ€ã€‚

```js
// åˆ›å»ºä¸€ä¸ª ArrayBuffer
const buffer = new ArrayBuffer(16);
const view = new Uint8Array(buffer);
view.set([1, 2, 3, 4]);

// è½¬ç§» ArrayBuffer
const transferred = buffer.transfer();

// åŸå§‹ buffer ç°åœ¨å·²è¢«åˆ†ç¦»
console.log(buffer.byteLength); // 0
console.log(buffer.detached); // true

// æ–°çš„ buffer åŒ…å«åŸå§‹æ•°æ®
const newView = new Uint8Array(transferred);
console.log(newView[0], newView[1], newView[2], newView[3]); // 1 2 3 4
console.log(transferred.byteLength); // 16
```

### `ArrayBuffer.prototype.transferToFixedLength()`
`transferToFixedLength()` æ–¹æ³•ä¸ `transfer()` ç±»ä¼¼ï¼Œä½†å…è®¸æŒ‡å®šæ–° ArrayBuffer çš„å¤§å°ã€‚å¦‚æœæŒ‡å®šçš„å¤§å°å°äºåŸå§‹ ArrayBufferï¼Œæ•°æ®ä¼šè¢«æˆªæ–­ï¼›å¦‚æœå¤§äºåŸå§‹ ArrayBufferï¼Œå¤šä½™çš„éƒ¨åˆ†ä¼šè¢«å¡«å……ä¸º 0ã€‚

```js
// åˆ›å»ºä¸€ä¸ª ArrayBuffer
const buffer = new ArrayBuffer(16);
const view = new Uint8Array(buffer);
view.set([1, 2, 3, 4]);

// è½¬ç§»åˆ°æ›´å°çš„ ArrayBuffer
const smaller = buffer.transferToFixedLength(2);
console.log(buffer.detached); // true
const smallerView = new Uint8Array(smaller);
console.log(smallerView.length); // 2
console.log(smallerView[0], smallerView[1]); // 1 2

// åˆ›å»ºå¦ä¸€ä¸ª ArrayBuffer
const buffer2 = new ArrayBuffer(4);
const view2 = new Uint8Array(buffer2);
view2.set([5, 6, 7, 8]);

// è½¬ç§»åˆ°æ›´å¤§çš„ ArrayBuffer
const larger = buffer2.transferToFixedLength(8);
console.log(buffer2.detached); // true
const largerView = new Uint8Array(larger);
console.log(largerView.length); // 8
console.log(largerView[0], largerView[1], largerView[2], largerView[3]); // 5 6 7 8
console.log(largerView[4], largerView[5], largerView[6], largerView[7]); // 0 0 0 0
```

### `ArrayBuffer.prototype.detached`
ES2024 è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„åªè¯»å±æ€§ `detached` ï¼Œç”¨äºæ£€æŸ¥ ArrayBuffer æ˜¯å¦å·²è¢«åˆ†ç¦»ã€‚

```js
const buffer = new ArrayBuffer(16);
console.log(buffer.detached); // false

const transferred = buffer.transfer();
console.log(buffer.detached); // true
console.log(transferred.detached); // false
```

## REF
> https://github.com/tc39/proposals/blob/main/finished-proposals.md  
> https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/encodeURI  
> https://v8.dev/features/regexp-v-flag
