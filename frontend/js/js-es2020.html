<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES2020 | Notes </title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/notes/logo.png">
    <link rel="manifest" href="/notes/manifest.json">
    <link rel="apple-touch-icon" href="/notes/icons/apple-touch-icon-152x152.png">
    <meta name="description" content="Just notes">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/notes/assets/css/0.styles.43e5f3f4.css" as="style"><link rel="preload" href="/notes/assets/js/app.a8879ba9.js" as="script"><link rel="preload" href="/notes/assets/js/3.eedc34e1.js" as="script"><link rel="preload" href="/notes/assets/js/61.3dd8ecc8.js" as="script"><link rel="preload" href="/notes/assets/js/4.851aaad8.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.0c68de8c.js"><link rel="prefetch" href="/notes/assets/js/11.a1e904a6.js"><link rel="prefetch" href="/notes/assets/js/12.9ad0289d.js"><link rel="prefetch" href="/notes/assets/js/13.00174e88.js"><link rel="prefetch" href="/notes/assets/js/14.b431cc8e.js"><link rel="prefetch" href="/notes/assets/js/15.ddc4f63a.js"><link rel="prefetch" href="/notes/assets/js/16.750d9e97.js"><link rel="prefetch" href="/notes/assets/js/17.7c1cecb3.js"><link rel="prefetch" href="/notes/assets/js/18.55069c90.js"><link rel="prefetch" href="/notes/assets/js/19.ecd904cb.js"><link rel="prefetch" href="/notes/assets/js/20.90dca096.js"><link rel="prefetch" href="/notes/assets/js/21.5f35bd70.js"><link rel="prefetch" href="/notes/assets/js/22.0e503f91.js"><link rel="prefetch" href="/notes/assets/js/23.75972f5d.js"><link rel="prefetch" href="/notes/assets/js/24.e04f01ce.js"><link rel="prefetch" href="/notes/assets/js/25.60df87a7.js"><link rel="prefetch" href="/notes/assets/js/26.4df1fe01.js"><link rel="prefetch" href="/notes/assets/js/27.7b7cd842.js"><link rel="prefetch" href="/notes/assets/js/28.ece35dc8.js"><link rel="prefetch" href="/notes/assets/js/29.5a82c605.js"><link rel="prefetch" href="/notes/assets/js/30.c77785f3.js"><link rel="prefetch" href="/notes/assets/js/31.06166a55.js"><link rel="prefetch" href="/notes/assets/js/32.fe79e054.js"><link rel="prefetch" href="/notes/assets/js/33.fae54841.js"><link rel="prefetch" href="/notes/assets/js/34.bc1bf374.js"><link rel="prefetch" href="/notes/assets/js/35.1a2beefe.js"><link rel="prefetch" href="/notes/assets/js/36.5a8e88ee.js"><link rel="prefetch" href="/notes/assets/js/37.465b868c.js"><link rel="prefetch" href="/notes/assets/js/38.077b8408.js"><link rel="prefetch" href="/notes/assets/js/39.448d2b32.js"><link rel="prefetch" href="/notes/assets/js/40.6c84a1c5.js"><link rel="prefetch" href="/notes/assets/js/41.2ea06996.js"><link rel="prefetch" href="/notes/assets/js/42.94c77ed5.js"><link rel="prefetch" href="/notes/assets/js/43.de9547ec.js"><link rel="prefetch" href="/notes/assets/js/44.2bd40b86.js"><link rel="prefetch" href="/notes/assets/js/45.5d66cd54.js"><link rel="prefetch" href="/notes/assets/js/46.4d1c9722.js"><link rel="prefetch" href="/notes/assets/js/47.9f200e4d.js"><link rel="prefetch" href="/notes/assets/js/48.b22a6f98.js"><link rel="prefetch" href="/notes/assets/js/49.7dff87c7.js"><link rel="prefetch" href="/notes/assets/js/5.30c8cc60.js"><link rel="prefetch" href="/notes/assets/js/50.a1ed16d4.js"><link rel="prefetch" href="/notes/assets/js/51.b8506ae2.js"><link rel="prefetch" href="/notes/assets/js/52.359a994e.js"><link rel="prefetch" href="/notes/assets/js/53.07796b6c.js"><link rel="prefetch" href="/notes/assets/js/54.3444d8c3.js"><link rel="prefetch" href="/notes/assets/js/55.0284dbf7.js"><link rel="prefetch" href="/notes/assets/js/56.0e20837a.js"><link rel="prefetch" href="/notes/assets/js/57.b520f419.js"><link rel="prefetch" href="/notes/assets/js/58.a8c4ebbb.js"><link rel="prefetch" href="/notes/assets/js/59.d98083c6.js"><link rel="prefetch" href="/notes/assets/js/6.31991f89.js"><link rel="prefetch" href="/notes/assets/js/60.b5de2c8d.js"><link rel="prefetch" href="/notes/assets/js/62.7a4e1fdd.js"><link rel="prefetch" href="/notes/assets/js/63.00699f40.js"><link rel="prefetch" href="/notes/assets/js/64.138a922b.js"><link rel="prefetch" href="/notes/assets/js/65.e1459a41.js"><link rel="prefetch" href="/notes/assets/js/66.5fe15316.js"><link rel="prefetch" href="/notes/assets/js/67.4bbf6c33.js"><link rel="prefetch" href="/notes/assets/js/68.572975f6.js"><link rel="prefetch" href="/notes/assets/js/69.5319f929.js"><link rel="prefetch" href="/notes/assets/js/7.4ba66d62.js"><link rel="prefetch" href="/notes/assets/js/70.07ba3a01.js"><link rel="prefetch" href="/notes/assets/js/71.3bdea942.js"><link rel="prefetch" href="/notes/assets/js/72.427bec74.js"><link rel="prefetch" href="/notes/assets/js/73.748bd7b0.js"><link rel="prefetch" href="/notes/assets/js/74.013aaa13.js"><link rel="prefetch" href="/notes/assets/js/75.ada39242.js"><link rel="prefetch" href="/notes/assets/js/76.4b19ee0b.js"><link rel="prefetch" href="/notes/assets/js/77.308b97d6.js"><link rel="prefetch" href="/notes/assets/js/78.cac3b807.js"><link rel="prefetch" href="/notes/assets/js/8.136a887f.js"><link rel="prefetch" href="/notes/assets/js/9.7ce5a3a1.js"><link rel="prefetch" href="/notes/assets/js/vendors~docsearch.883d461f.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.43e5f3f4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">Notes </span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法与数据结构" class="dropdown-title"><span class="title">算法与数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/algorithm/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/frontend/browser/" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/notes/frontend/js/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/notes/frontend/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/backend/nodejs/" class="nav-link">
  Node.js
</a></li></ul></div></div> <a href="https://github.com/sluggishpj/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法与数据结构" class="dropdown-title"><span class="title">算法与数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/algorithm/data-structure/" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/frontend/browser/" class="nav-link">
  Browser
</a></li><li class="dropdown-item"><!----> <a href="/notes/frontend/js/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/notes/frontend/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/backend/nodejs/" class="nav-link">
  Node.js
</a></li></ul></div></div> <a href="https://github.com/sluggishpj/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/frontend/" aria-current="page" class="sidebar-link">前言</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Browser</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/frontend/js/" aria-current="page" class="sidebar-link">说明</a></li><li><a href="/notes/frontend/js/js-in-html.html" class="sidebar-link">在HTML中使用JS</a></li><li><a href="/notes/frontend/js/js-grammar-and-types.html" class="sidebar-link">语法与数据类型</a></li><li><a href="/notes/frontend/js/js-control-flow-and-error-handling.html" class="sidebar-link">流程控制与异常处理</a></li><li><a href="/notes/frontend/js/js-functions.html" class="sidebar-link">函数</a></li><li><a href="/notes/frontend/js/js-expressions-and-operators.html" class="sidebar-link">表达式和运算符</a></li><li><a href="/notes/frontend/js/js-numbers-and-dates.html" class="sidebar-link">数字和日期</a></li><li><a href="/notes/frontend/js/js-text-formatting.html" class="sidebar-link">字符串与文本</a></li><li><a href="/notes/frontend/js/js-regular-expressions.html" class="sidebar-link">正则表达式</a></li><li><a href="/notes/frontend/js/js-indexed-collections.html" class="sidebar-link">索引集合类</a></li><li><a href="/notes/frontend/js/js-keyed-collections.html" class="sidebar-link">带键的集合</a></li><li><a href="/notes/frontend/js/js-working-with-objects.html" class="sidebar-link">对象</a></li><li><a href="/notes/frontend/js/js-promises.html" class="sidebar-link">Promise</a></li><li><a href="/notes/frontend/js/js-meta-programming.html" class="sidebar-link">元编程</a></li><li><a href="/notes/frontend/js/js-modules.html" class="sidebar-link">JS modules 模块</a></li><li><a href="/notes/frontend/js/js-strict-mode.html" class="sidebar-link">严格模式</a></li><li><a href="/notes/frontend/js/js-es2020.html" aria-current="page" class="active sidebar-link">ES2020</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#dynamic-import" class="sidebar-link">Dynamic Import()</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#static-import" class="sidebar-link">Static import</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#dynamic-import-2" class="sidebar-link">Dynamic Import</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#bigint" class="sidebar-link">BigInt</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#比较" class="sidebar-link">比较</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#操作符" class="sidebar-link">操作符</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#api" class="sidebar-link">API</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#string-prototype-matchall" class="sidebar-link">String.prototype.matchAll</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#promise-allsettled" class="sidebar-link">Promise.allSettled</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#globalthis" class="sidebar-link">globalThis</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#optional-chaining-可选链" class="sidebar-link">Optional chaining (可选链)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#获取属性" class="sidebar-link">获取属性</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#执行方法" class="sidebar-link">执行方法</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#动态属性" class="sidebar-link">动态属性</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#可选链特性" class="sidebar-link">可选链特性</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#nullish-coalescing-operator-空值合并运算符" class="sidebar-link">Nullish coalescing operator 空值合并运算符 (??)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#不能与-and-或-or-操作符共用" class="sidebar-link">不能与 AND(&amp;&amp;) 或 OR(||) 操作符共用</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#atomics" class="sidebar-link">Atomics</a></li><li class="sidebar-sub-header"><a href="/notes/frontend/js/js-es2020.html#ref" class="sidebar-link">REF</a></li></ul></li><li><a href="/notes/frontend/js/js-es2021.html" class="sidebar-link">ES2021</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="es2020"><a href="#es2020" class="header-anchor">#</a> ES2020</h1> <h2 id="dynamic-import"><a href="#dynamic-import" class="header-anchor">#</a> Dynamic <code>Import()</code></h2> <h3 id="static-import"><a href="#static-import" class="header-anchor">#</a> Static <code>import</code></h3> <p>静态 <code>import</code> 在 ES2015 就存在了</p> <ul><li><code>./utils.mjs</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Default export</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi from the default export!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Named export `doStuff`</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">doStuff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Doing stuff…'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>静态 <code>import</code> 使用如下</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module <span class="token keyword">from</span> <span class="token string">'./utils.mjs'</span>
  module<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// → logs 'Hi from the default export!'</span>
  module<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// → logs 'Doing stuff…'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>后缀 <code>.mjs</code> 在浏览器并没有实际意义，因为已经有 <code>type=&quot;module&quot;</code>，以及通过<code>Content-Type</code> 返回 MIME type (<code>text/javascript</code>)。 在 <code>Node.js</code> 中就有用。</p></blockquote> <p>静态 <code>import</code> (<code>import xxx from yyy</code>) 只能接收 字符串字面值 作为 module specifier。并通过 pre-runtime &quot;linking&quot; 绑定到本地作用域。静态<code>import</code> 只能放在文件的最上层。没法做到以下几点：</p> <ul><li>import a module on-demand (or conditionally)</li> <li>compute the module specifier at runtime</li> <li>import a module from within a regular script (as opposed to a module)</li></ul> <h3 id="dynamic-import-2"><a href="#dynamic-import-2" class="header-anchor">#</a> Dynamic Import</h3> <p><code>import(moduleSpecifier)</code> 返回一个 promise。(after fetching, instantiating, and evaluating all of the module’s dependencies, as well as the module itself.)</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> moduleSpecifier <span class="token operator">=</span> <span class="token string">'./utils.mjs'</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span>moduleSpecifier<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// → logs 'Hi from the default export!'</span>
    module<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// → logs 'Doing stuff…'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>也可以用 <code>async/await</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> moduleSpecifier <span class="token operator">=</span> <span class="token string">'./utils.mjs'</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>moduleSpecifier<span class="token punctuation">)</span>
    module<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// → logs 'Hi from the default export!'</span>
    module<span class="token punctuation">.</span><span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// → logs 'Doing stuff…'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p><code>import</code> 不是函数， 也不是 对象。<code>const importAlias = import</code>会报错。</p></blockquote> <h2 id="bigint"><a href="#bigint" class="header-anchor">#</a> BigInt</h2> <p><code>BigInt</code> 是新的原始数据类型，用来安全地操作超过<code>Number.MIN_SAFE_INTEGER</code> ~ <code>Number.MAX_SAFE_INTEGER</code> 范围外的整数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token number">1n</span> <span class="token comment">// bigint</span>

Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token comment">// 9007199254740991，即 2**53 - 1</span>

Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">===</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token comment">// true</span>

<span class="token number">9007199254740991n</span> <span class="token operator">+</span> <span class="token number">1n</span> <span class="token operator">===</span> <span class="token number">9007199254740991n</span> <span class="token operator">+</span> <span class="token number">2n</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>安全存储的意思是指能够准确区分两个不相同的值</p></blockquote> <h3 id="比较"><a href="#比较" class="header-anchor">#</a> 比较</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">42</span> <span class="token operator">===</span> <span class="token number">42n</span> <span class="token comment">// false</span>
<span class="token number">42n</span> <span class="token operator">===</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">42n</span> <span class="token operator">==</span> <span class="token number">42</span> <span class="token comment">// true</span>

<span class="token number">123</span> <span class="token operator">&lt;</span> <span class="token number">124n</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="操作符"><a href="#操作符" class="header-anchor">#</a> 操作符</h3> <ul><li>二则运算
<ul><li><code>+</code>, <code>-</code>, <code>*</code>, <code>**</code> 正常</li> <li><code>/</code> 和 <code>%</code>，结果向 0 取整（丢弃小数部分）</li></ul></li> <li>二进制运算 <code>|</code>, <code>&amp;</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>^</code> 正常</li></ul> <blockquote><p>不要把 Number 类型和 BigInt 类型 混合运算，会报错</p></blockquote> <h3 id="api"><a href="#api" class="header-anchor">#</a> API</h3> <ul><li><code>BigInt</code> 构造函数跟 <code>Number</code> 构造函数类似: 将参数转换为 <code>BigInt</code> ，如果转换失败，则报 <code>SyntaxError</code> 或 <code>RangeError</code>。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token comment">// → 123n</span>
<span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span>
<span class="token comment">// → RangeError</span>
<span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token string">'1.5'</span><span class="token punctuation">)</span>
<span class="token comment">// → SyntaxError</span>

<span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">123456789123456789</span><span class="token punctuation">)</span> <span class="token comment">// 参数是安全范围外的数字，会发生精度丢失</span>
<span class="token comment">// → 123456789123456784n ❌</span>
<span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token string">'123456789123456789'</span><span class="token punctuation">)</span> <span class="token comment">// 参数是整数字符串形式，正常</span>
<span class="token comment">// → 123456789123456789n ✅</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>BigInt.asIntN(width, bigint)</code>: 将 bigint 对应的值转换为 width 位 有符号整数</li> <li><code>BigInt.asUintN(width, bigint)</code>: 将 bigint 对应的值转换为 width 位 无符号整数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Highest possible BigInt value that can be represented as a</span>
<span class="token comment">// signed 64-bit integer.</span>
<span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token number">2n</span> <span class="token operator">**</span> <span class="token punctuation">(</span><span class="token number">64n</span> <span class="token operator">-</span> <span class="token number">1n</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1n</span>
BigInt<span class="token punctuation">.</span><span class="token function">asIntN</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span>
<span class="token comment">// → 9223372036854775807n</span>
BigInt<span class="token punctuation">.</span><span class="token function">asIntN</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> max <span class="token operator">+</span> <span class="token number">1n</span><span class="token punctuation">)</span>
<span class="token comment">// → -9223372036854775808n</span>
<span class="token comment">//   ^ negative because of overflow</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><code>BigInt64Array</code>: 每一项都是 64 位 有符号整数。<code>BigUint64Array</code> 则为对应的 64 位无符号整数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInt64Array</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment">// → [0n, 0n, 0n, 0n]</span>
view<span class="token punctuation">.</span>length
<span class="token comment">// → 4</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">// → 0n</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42n</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">// → 42n</span>

<span class="token comment">// Highest possible BigInt value that can be represented as a</span>
<span class="token comment">// signed 64-bit integer.</span>
<span class="token keyword">const</span> max <span class="token operator">=</span> <span class="token number">2n</span> <span class="token operator">**</span> <span class="token punctuation">(</span><span class="token number">64n</span> <span class="token operator">-</span> <span class="token number">1n</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1n</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> max
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">// → 9_223_372_036_854_775_807n</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> max <span class="token operator">+</span> <span class="token number">1n</span>
view<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">// → -9_223_372_036_854_775_808n</span>
<span class="token comment">//   ^ negative because of overflow</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>MORE: <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt64Array" target="_blank" rel="noopener noreferrer">BigInt64Array<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="string-prototype-matchall"><a href="#string-prototype-matchall" class="header-anchor">#</a> <code>String.prototype.matchAll</code></h2> <p><code>String#match</code>方法，只会返回匹配的字符串，没有其他信息（比如 index）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token string">'Magic hex numbers: DEADBEEF CAFE'</span>
<span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b\p{ASCII_Hex_Digit}+\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gu</span></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> match <span class="token keyword">of</span> string<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Output:</span>
<span class="token comment">// 'DEADBEEF'</span>
<span class="token comment">// 'CAFE'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>可以使用 <code>Regexp#exec</code>，就是有点繁琐</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token string">'Magic hex numbers: DEADBEEF CAFE'</span>
<span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b\p{ASCII_Hex_Digit}+\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gu</span></span>
<span class="token keyword">let</span> match
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>match <span class="token operator">=</span> regex<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Output:</span>
<span class="token comment">// [ 'DEADBEEF', index: 19, input: 'Magic hex numbers: DEADBEEF CAFE', groups: undefined ]</span>
<span class="token comment">// [ 'CAFE',     index: 28, input: 'Magic hex numbers: DEADBEEF CAFE', groups: undefined ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用 <code>String#matchAll</code> 达到上面的效果</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token string">'Magic hex numbers: DEADBEEF CAFE'</span>
<span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b\p{ASCII_Hex_Digit}+\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gu</span></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> match <span class="token keyword">of</span> string<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>match<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Output:</span>
<span class="token comment">// [ 'DEADBEEF', index: 19, input: 'Magic hex numbers: DEADBEEF CAFE', groups: undefined ]</span>
<span class="token comment">// [ 'CAFE',     index: 28, input: 'Magic hex numbers: DEADBEEF CAFE', groups: undefined ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>String#matchAll</code> 也有对应的 capture groups</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token string">'Favorite GitHub repos: tc39/ecma262 v8/v8.dev'</span>
<span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b(?&lt;owner&gt;[a-z0-9]+)\/(?&lt;repo&gt;[a-z0-9\.]+)\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> match <span class="token keyword">of</span> string<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">.</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> with '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">.</span>input<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">→ owner: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>owner<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">→ repo: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>match<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>repo<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Output:</span>
<span class="token comment">// tc39/ecma262 at 23 with 'Favorite GitHub repos: tc39/ecma262 v8/v8.dev'</span>
<span class="token comment">// → owner: tc39</span>
<span class="token comment">// → repo: ecma262</span>
<span class="token comment">// v8/v8.dev at 36 with 'Favorite GitHub repos: tc39/ecma262 v8/v8.dev'</span>
<span class="token comment">// → owner: v8</span>
<span class="token comment">// → repo: v8.dev</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="promise-allsettled"><a href="#promise-allsettled" class="header-anchor">#</a> <code>Promise.allSettled</code></h2> <p>返回一个在所有给定的 promise 都已经 fulfilled 或 rejected 后的 promise，并带有一个对象数组，每个对象表示对应的 promise 结果</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span>

Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Output:</span>
<span class="token comment">// Object { status: &quot;fulfilled&quot;, value: 3 }</span>
<span class="token comment">// Object { status: &quot;rejected&quot;, reason: &quot;foo&quot; }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>对于每个结果对象，都有一个 <code>status</code> 字符串。</p> <ul><li>如果它的值为 <code>fulfilled</code>, 则结果对象上存在一个 <code>value</code> 。</li> <li>如果值为 <code>rejected</code>, 则存在一个 <code>reason</code> 。</li></ul> <p>value（或 reason ）反映了每个 promise 决议（或拒绝）的值。</p> <h2 id="globalthis"><a href="#globalthis" class="header-anchor">#</a> <code>globalThis</code></h2> <p>返回全局对象。</p> <p>未出现 <code>globalThis</code> 前，在 Web 中，可以通过 <code>window</code>, <code>self</code> 或者 <code>frames</code> 取到全局对象，但是在 Web Workers 中，只有 <code>self</code> 可以。在 Node.js 中，它们都无法获取，必须使用 <code>global</code>。</p> <p>也可以直接使用 <code>Function('return this')()</code>, 但可能会违反 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener noreferrer">CSP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 规则。所以 <a href="https://github.com/paulmillr/es6-shim" target="_blank" rel="noopener noreferrer">es6-shim<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 使用如下方式:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">getGlobal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> self <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> self
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> global <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> global
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unable to locate global object'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> globals <span class="token operator">=</span> <span class="token function">getGlobal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> globals<span class="token punctuation">.</span>setTimeout <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 此环境中没有 setTimeout 方法！</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>有了 <code>globalThis</code> 只需要</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> globalThis<span class="token punctuation">.</span>setTimeout <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//  此环境中没有 setTimeout 方法！</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="optional-chaining-可选链"><a href="#optional-chaining-可选链" class="header-anchor">#</a> Optional chaining (可选链)</h2> <h3 id="获取属性"><a href="#获取属性" class="header-anchor">#</a> 获取属性</h3> <p>before</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> nameLength <span class="token operator">=</span> db
  <span class="token operator">?</span> db<span class="token punctuation">.</span>user
    <span class="token operator">?</span> db<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name
      <span class="token operator">?</span> db<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">.</span>length
      <span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token operator">:</span> <span class="token keyword">undefined</span>
  <span class="token operator">:</span> <span class="token keyword">undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>after</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> nameLength <span class="token operator">=</span> db<span class="token operator">?.</span>user<span class="token operator">?.</span>name<span class="token operator">?.</span>length
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="执行方法"><a href="#执行方法" class="header-anchor">#</a> 执行方法</h3> <p><code>?.()</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> adminOption <span class="token operator">=</span> db<span class="token operator">?.</span>user<span class="token operator">?.</span>validateAdminAndGetPrefs<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>option
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="动态属性"><a href="#动态属性" class="header-anchor">#</a> 动态属性</h3> <p><code>?.[dynamic]</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> optionName <span class="token operator">=</span> <span class="token string">'optional setting'</span>
<span class="token keyword">const</span> optionLength <span class="token operator">=</span> db<span class="token operator">?.</span>user<span class="token operator">?.</span>preferences<span class="token operator">?.</span><span class="token punctuation">[</span>optionName<span class="token punctuation">]</span><span class="token punctuation">.</span>length
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="可选链特性"><a href="#可选链特性" class="header-anchor">#</a> 可选链特性</h3> <ul><li>Short-circuiting (短路): 如果提前返回则不会执行剩余的表达式</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当 db 和 db.user 存在时，才会执行 ++age</span>
<span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">0</span>
db<span class="token operator">?.</span>user<span class="token operator">?.</span><span class="token function">grow</span><span class="token punctuation">(</span><span class="token operator">++</span>age<span class="token punctuation">)</span>

age <span class="token comment">// 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>Optional delection</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当 db 存在时，才会删除 `db.user`</span>
<span class="token keyword">delete</span> db<span class="token operator">?.</span>user
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>可以和 空值合并运算符 (??) 一块使用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> customer <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Carl'</span><span class="token punctuation">,</span>
  details<span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">82</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> customerCity <span class="token operator">=</span> customer<span class="token operator">?.</span>city <span class="token operator">??</span> <span class="token string">'Unknown city'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>customerCity<span class="token punctuation">)</span> <span class="token comment">// Unknown city</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="nullish-coalescing-operator-空值合并运算符"><a href="#nullish-coalescing-operator-空值合并运算符" class="header-anchor">#</a> Nullish coalescing operator 空值合并运算符 (??)</h2> <p>空值合并操作符（<code>??</code>）是一个逻辑操作符，当左侧的操作数为 <code>null</code> 或者 <code>undefined</code> 时，返回其右侧操作数，否则返回左侧操作数。</p> <h3 id="不能与-and-或-or-操作符共用"><a href="#不能与-and-或-or-操作符共用" class="header-anchor">#</a> 不能与 AND(&amp;&amp;) 或 OR(||) 操作符共用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">undefined</span> <span class="token operator">??</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 SyntaxError</span>
<span class="token boolean">true</span> <span class="token operator">||</span> <span class="token keyword">undefined</span> <span class="token operator">??</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 SyntaxError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>如果使用括号来显式表明运算优先级，是没有问题的</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'foo'</span> <span class="token comment">// 返回 &quot;foo&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="atomics"><a href="#atomics" class="header-anchor">#</a> Atomics</h2> <blockquote><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics" target="_blank" rel="noopener noreferrer">Atomics | MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <blockquote><p>MORE: https://v8.dev/features/atomics</p></blockquote> <h2 id="ref"><a href="#ref" class="header-anchor">#</a> REF</h2> <blockquote><p>https://v8.dev/features/tags/es2020</p></blockquote> <blockquote><p>https://github.com/tc39/proposals/blob/master/finished-proposals.md</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/sluggishpj/notes/edit/master/docs/frontend/js/js-es2020.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/22/2021, 2:11:49 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/frontend/js/js-strict-mode.html" class="prev">
        严格模式
      </a></span> <span class="next"><a href="/notes/frontend/js/js-es2021.html">
        ES2021
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/notes/assets/js/app.a8879ba9.js" defer></script><script src="/notes/assets/js/3.eedc34e1.js" defer></script><script src="/notes/assets/js/61.3dd8ecc8.js" defer></script><script src="/notes/assets/js/4.851aaad8.js" defer></script>
  </body>
</html>
